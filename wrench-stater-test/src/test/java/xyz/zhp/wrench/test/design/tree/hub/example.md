# 设计模式实现
## 案例1 - 实现秒杀场景
````
访问接口
    if[是否限流]
        return "当前访问过多";
    else 
        if[用户是否登录]
            return "请您先登录";
        else
            if[是否是机器人刷单]
                封禁账号
                return "账号存在刷单行为";
            else
                if[是否达到限购数量]
                    读取redis判断
                    return "您已达最大限购数量，请期待下一次活动"
                else 
                    1. 查询redis库存
                        if[库存不足]
                            return "已售罄"
                        else
                            进行原子性扣减
                            if[扣减失败]
                                return 当前访问过多;
                            else
                                redis 添加用户购买数量
                                mq发送-创建订单
                                return "请及时付款";
````
- 实现后，若干天 =》》产品经理再次改需求
1. 限区：我想添加一个针对指定城市的限购，比如正常限购5个，针对xxx市，只能限购3个，剩下城市限购正常
   本质：新增业务功能
2. 风控：我想增添，针对刷单行为，若账号频繁刷单，进行封号处理，并在用户秒杀时，判断账号状态

- 实现后，若干天 =》》产品经理再次改需求
1. 风控：我想添加若针对刷单行为，会产生封号，那在此期间若这个账号抢到别的商品下单，进行订单取消，标记为异常订单

- 实现后，若干天 =》》产品经理再次改需求
1. 优化："当前访问过多"的提示不美观，我想换成"您还差一点就能抢到了"
2. 留活：并且在访问过多的业务节点，新增若用户无刷单行，赠予客户20元券

详情看ProcessOn